
由**优化器**添加的惰性spool，用于降低嵌套循环链接的预估成本。

- lazy Table Spool
- lazy Index Spool
- lazy Row Count Spool


nested loop join 有两种执行计划；将具有外部引用的种类称为 **apply**，将具有连接运算符本身的连接谓词的类型称为 **nested loops join** 。这种区别在于_执行计划运算符_，而不是 T-SQL 查询语法。


![[Pasted image 20250603142850.png]]


所有spool都是惰性的。

随着行在线轴中流动，线轴的工作表会逐渐填充，一次一行。（相比之下，急切线轴会先处理完其子运算符的所有输入，然后再将任何行返回给父运算符。）

性能线轴始终出现在嵌套循环连接或应用运算符的**内侧**（图形执行计划中的下部输入）。其基本思路是缓存并重放结果，尽可能地减少内侧运算符的重复执行。

当 spool 能够重放缓存的结果时，这被称为**倒带**。当 spool 必须执行其子操作符才能获得正确的数据时，就会发生**重新绑定**。

it helpful to think of a spool _rebind_ as a cache miss, and a _rewind_ as a cache hit.


更细的可以查看。
https://www.sql.kiwi/2019/09/nested-loops-joins-performance-spools/

优化器规则

我们无法使用t-sql 指定spool；意味着优化器必须在其选择的探索方案之中包含一个逻辑spool。

- 查询树中的每个逻辑运算符都会根据当前优化阶段可用的规则进行快速模式匹配检查。
- 匹配成功后，候选规则会被要求生成一个承诺值。该数字表示在给定特定上下文的情况下，当前规则生成有用结果的可能性
- 一旦确定了有前景的探索规则，优化器会按预期价值顺序对其进行排序，并开始要求他们生成新的逻辑替代方案。每条规则可能生成一个或多个替代方案，这些替代方案稍后将使用物理运算符来实现。并在此过程中，计算预估成本。
- 







