Spinlock 

自旋锁是用于保护数据的一种特殊形式的锁。自旋锁是SQLOS用来保护数据结构访问的==轻量级对象==。


#### SQL Server 中查询执行周期
SQLOS完全负责SQL Server的线程调度。
在现代CPU环境中，SQLOS会为每个CPU内核分配一个scheduler程序（SOS）来进行线程管理。（4个八核cpu的机器，SQLOS将产生32个scheduler程序）

![[Pasted image 20220609150430.png]]


### SOS由三部分组成：
- Runnable Queue - 采用严格的先入先出（FIFO）顺序来处理必须处理的线程。从cpu，waiter list过度到runnable queue的线程将唯一队列中的最后一个，并且它必须等待先前移入可运行队列的所有线程（启用资源管理器时，可以覆盖FIFO顺序与启用的调控器一样，资源池优先级可以不同地分配给工作负载组。资源调控器的使用通常很少见）
- CPU - 负责处理线程的物理/逻辑CPU Core. **一次只能处理一个线程**
- Waiter List - 所有处于挂起状态的线程都存储在此。挂起的线程是必须等待资源可供他们使用的线程。在等待列表中的线程并没有强加的限制时间。但，当查询执行会话超时，此线程将在等待列表中取消。

###



#SQLServer/lock