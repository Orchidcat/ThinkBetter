#zmk

```config/your_board.conf
CONFIG_ZMK_PM_SOFT_OFF=y # 启用软关机 
CONFIG_ZMK_SLEEP=y # 启用深度睡眠（可选，但推荐与软关机结合） 
CONFIG_ZMK_GPIO_KEYS=y # 启用 GPIO 键支持
```

.dts / .overlay
```
/ {
    // 定义 GPIO 键（P0.19，低电平有效，上拉）
    keys {
        compatible = "gpio-keys";
        soft_off_gpio_key: soft_off_gpio_key {
            gpios = <&gpio0 19 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
        };
    };

    // 创建直接扫描矩阵（用于独立引脚）
    wakeup_scan: wakeup_scan {
        compatible = "zmk,kscan-gpio-direct";
        input-keys = <&soft_off_gpio_key>;
        wakeup-source;
    };

    // 侧带行为触发（绑定到软关机行为）
    side_band_behavior_triggers: side_band_behavior_triggers {
        compatible = "zmk,kscan-sideband-behaviors";
        kscan = <&wakeup_scan>;
        auto-enable;
        wakeup-source;
        soft_off {
            column = <0>;
            row = <0>;
            bindings = <&hw_soft_off>;
        };
    };

    // 定义软关机行为
    behaviors {
        hw_soft_off: hw_soft_off {
            compatible = "zmk,behavior-soft-off";
            #binding-cells = <0>;
            split-peripheral-off-on-press;
            hold-time-ms = <2000>;  // 按住 2 秒触发软关机
        };
    };

    // 注册唤醒源（软关机后保持活跃以支持唤醒）
    soft_off_wakers {
        compatible = "zmk,soft-off-wakeup-sources";
        wakeup-sources = <&wakeup_scan>;
    };
};
```


引脚控制 (可选，如果需要额外配置）：在 -pinctrl.dtsi 文件中，确保 P0.19 配置为 GPIO
```
&pinctrl {
    gpio_default: gpio_default {
        group1 {
            psels = <NRF_PSEL(GPIO_OUT, 0, 19)>;  // 配置 P0.19 为 GPIO 输出（如果需要）
            bias-pull-up;  // 启用上拉（已在上文 gpios 中定义）
        };
    };
};
```

然后在驱动节点中引用：pinctrl-0 = <&gpio_default>;。



思路：
- **触发软关机**：按住电源键 2 秒（可通过 hold-time-ms 调整），键盘进入软关机状态（低功耗）。
- **唤醒**：再次按下电源键（或任何唤醒源）即可唤醒。
- **在键映射（keymap）中的引用**：此配置是硬件级别的，不需要在标准键映射（keymap.dtsi）中额外绑定键码，因为它是独立的侧带行为。如果想在键映射中引用类似行为，可以使用 &hw_soft_off 作为绑定，例如在层中：bindings = <&hw_soft_off>;。