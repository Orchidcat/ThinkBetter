#SQLServer 

```sql
-- 查看文件级别的I/O等待统计（最接近磁盘性能的SQL内视图）
SELECT 
    DB_NAME(vfs.database_id) AS DatabaseName,
    mf.name AS LogicalFileName,
    mf.physical_name AS PhysicalPath,
    mf.type_desc AS FileType,
    -- I/O等待统计（毫秒）
    CASE 
        WHEN vfs.num_of_reads > 0 
        THEN (vfs.io_stall_read_ms * 1.0 / vfs.num_of_reads) 
        ELSE 0 
    END AS AvgReadLatency_ms,
    CASE 
        WHEN vfs.num_of_writes > 0 
        THEN (vfs.io_stall_write_ms * 1.0 / vfs.num_of_writes) 
        ELSE 0 
    END AS AvgWriteLatency_ms,
    -- I/O吞吐量
    vfs.num_of_bytes_read / 1024.0 / 1024 AS TotalMBRead,
    vfs.num_of_bytes_written / 1024.0 / 1024 AS TotalMBWritten,
    -- 操作系统文件统计
    vfs.size_on_disk_bytes / 1024 / 1024 AS SizeOnDisk_MB,
    -- 根据延迟判断健康状况
    CASE 
        WHEN (vfs.io_stall_read_ms * 1.0 / NULLIF(vfs.num_of_reads, 0)) > 50 
            THEN '严重延迟'
        WHEN (vfs.io_stall_read_ms * 1.0 / NULLIF(vfs.num_of_reads, 0)) > 20 
            THEN '警告延迟' 
        ELSE '正常'
    END AS ReadHealthStatus
FROM 
    sys.dm_io_virtual_file_stats(NULL, NULL) AS vfs
JOIN 
    sys.master_files AS mf ON vfs.database_id = mf.database_id 
                           AND vfs.file_id = mf.file_id
ORDER BY 
    AvgReadLatency_ms DESC;
```
