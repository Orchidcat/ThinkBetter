#SQLServer 

B 树解决了一个根本性问题：当磁盘访问速度比内存访问慢数千倍时，如何高效地查找磁盘上的数据。


### 磁盘上的二叉搜索树



内存中的二叉树
![[Pasted image 20251128085125.png|300]]

查找一个键需要 O(log₂ n) 次比较。
对于 100 万条记录，平衡二叉搜索树的高度为 log₂(1,000,000) ≈ 20。也就是说，需要进行 20 次比较才能找到任何一条记录。在内存中大约是0.002毫秒。

但这在磁盘上操作就是灾难；

==磁盘IO成本过高==
按照数据块的读取（4KB到16KB） **磁盘速度比内存慢 100 到 100,000 倍。**

==二叉树灾难==
  在磁盘上存储二叉搜索树时，每个节点都存储在单独的磁盘块中。从父节点遍历到子节点需要进行磁盘寻道。

针对 100 万条记录：

- 高度：20 个节点
- 磁盘寻道次数：20
- 硬盘读取时间：20 × 10 毫秒 = **200 毫秒**
- SSD 耗时：20 × 0.1 毫秒 = **2 毫秒**

对于固态硬盘来说，这尚可接受，但对于机械硬盘来说就太糟糕了。而且随着硬盘体积增大，情况还会更糟。

针对10亿条记录：
- 高度：30 个节点
- 硬盘读写时间：30 × 10 毫秒 = **300 毫秒**
- SSD 耗时：30 × 0.1 毫秒 = **3 毫秒**

**根本问题在于：** 二叉搜索树的扇出度太低（每个节点只有两个子节点）。我们需要增加每个节点的子节点数量来降低树的高度。







参考：
[B-Trees: Why Every Database Uses Them - by Mehmet Gökçe](https://mehmetgoekce.substack.com/p/b-trees-why-every-database-uses-them)


