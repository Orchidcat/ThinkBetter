#SQLServer 

许多 SQL 人员认为他们在计划缓存中看到的执行计划是实际执行计划。不幸的是，这是一个估计执行计划。估计执行计划没有可能有助于查询调整的实际运行时统计信息。
实际执行计划具有您真正需要的运行时统计信息。那么，您可以使用查询存储功能来自动保留实际执行计划。但请记住，查询存储是一项成熟的功能，在实施之前需要仔细规划。是否有其他方法从计划缓存获取实际执行计划？延长活动？好吧，再说一次，需要实施，如果你没有进行足够的过滤，那么捕获计划可能会成为一件昂贵的事情。我的意思是，尝试只捕捉你想要的内容并减少噪音。还有什么？

在 SQL Server 2019 中，可以使用 DMF sys.dm_exec_query_plan_stats 检索先前缓存的查询计划的最后一个已知实际执行计划的等效项。请注意，这是一项选择加入功能。如果要在服务器级别为所有数据库启用此功能，请使用跟踪标志 2451。要在数据库级别启用，请打开 LAST_QUERY_PLAN_STATS 数据库范围的配置选项。