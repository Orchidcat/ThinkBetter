#程序编码

**有40个不同大小的版本**
**具有4种不同的纠错级别**
**可编码4种数据类型（数字，字母数字，二进制，汉字）**
**8种掩码模式**



[QR 码](http://en.wikipedia.org/wiki/QR_Code) 格式由日本公司[Denso-Wave](http://www.denso-wave.com/)于 1994 年创建， 该公司是丰田的子公司，生产汽车零部件。该标准在[ISO/IEC 18004:2006](http://www.iso.org/iso/catalogue_detail?csnumber=43655)中定义。二维码的使用是免许可的。

最小的二维码是 21x21 像素，最大的是 177x177。这些尺寸称为**版本**。21x21 像素大小是版本 1，25x25 是版本 2，依此类推。177x177 尺寸是版本 40。


此外，二维码还包括纠错功能：当您对二维码进行编码时，您还会创建一些冗余数据，以帮助二维码阅读器准确读取代码，即使其中部分代码无法读取。您可以选择四个级别的纠错。最低的是 L，即使有 7% 的代码不可读，也可以读取代码。之后是提供 15% 纠错的 M，然后是提供 25% 的 Q，最后是提供 30% 的 H。


## 创建方法


### 数据分析
二维码编码一串文本。QR 标准有四种文本编码模式：数字、字母数字、字节和汉字。每种模式都将文本编码为一串位（1 和 0），但每种模式使用不同的方法将文本转换为位，并且每种编码方法都经过优化，以使用尽可能短的位串对数据进行编码。因此，您的第一步应该是执行 [数据分析](https://www.thonky.com/qr-code-tutorial/data-analysis)以确定您的文本是否可以以数字、字母数字、字节或汉字模式编码，然后为您的文本选择最优化的模式。

#### 四种模式
* 数字模式：0到9的十进制数字
* 字母数字模式：0到9的十进制数字，以及大写字母（**不是小写**），符号￥% 以及空格；[[参考左侧列]](https://www.thonky.com/qr-code-tutorial/alphanumeric-table)
* 字节模式（**默认**）：适用于ISO-8859-1 字符集中的字符。但是，某些QR码扫描仪可以自动监测是否在字节模式下使用UTF-8
* kanji模式：适用于Shift JIS字符集中的双字节字符。
* 扩展通道（ECI）模式：直接制定字符集（例如UTF-8），一些阅读器无法解析
* 结构化附加模式：跨多个QR码对数据进行编码，最多16个QR码
* FNC1模式：允许QR码作为GS1条码

**编码可以选择多个模式**


### 数据编码
现在您已经为文本选择了合适的编码模式，下一步就是对文本进行编码。[数据编码](https://www.thonky.com/qr-code-tutorial/data-encoding)部分针对每种编码模式详细描述了此过程。此步骤的结果是一串位，该位串被分成每个 8 位长的数据码字

#### 选择纠错级别
![[Pasted image 20220729104346.png]]
#### 确定最小版本
[[字符容量表]](https://www.thonky.com/qr-code-tutorial/character-capacities)
计算要编码的字符数，并根据**编码模式**和所需的**纠错级别**确定哪个是可以包含该字符数的最小版本。

例如，短语**HELLO WORLD**有 11 个字符。如果使用 Q 级纠错对其进行编码， [字符容量](https://www.thonky.com/qr-code-tutorial/character-capacities) 表显示使用 Q 级纠错的版本 1 代码可以包含 16 个字母数字模式的字符，因此版本 1 是可以包含此字符数的最小版本。如果短语超过 16 个字符，例如 HELLO THERE WORLD（即 17 个字符）版本 2 将是最小的版本。

#### 添加模式指示器
例如，如果以字母数字模式编码**HELLO WORLD**，则模式指示符为 0010。
![[Pasted image 20220729104835.png]]

#### 添加字符计数指示器
字符计数指示符是一串位，表示正在编码的字符数。字符计数指示符必须放在模式指示符之后。此外，字符计数指示符必须是一定数量的位长，具体取决于 QR 版本。

计算原始输入文本中的字符数，然后将该数字转换为二进制。字符计数指示器的长度取决于编码模式和将使用的二维码版本。要使二进制字符串具有适当的长度，请在左侧用 0 填充。

以下列表包含每种模式和版本的字符计数指示器的大小。例如，如果以字母数字模式在版本 1 QR 码中编码**HELLO WORLD** ，则字符计数指示符必须为 9 位长。**HELLO WORLD**的字符数是 11。在二进制中，11 是 1011。将其填充到左侧使其长 9 位：000001011。将其放在步骤 3 中的模式指示符之后，得到以下位串：0010 00000101
![[Pasted image 20220729105139.png]]


#### 使用所选模式进行编码

-   [数字模式编码](https://www.thonky.com/qr-code-tutorial/numeric-mode-encoding)
-   [字母数字模式编码](https://www.thonky.com/qr-code-tutorial/alphanumeric-mode-encoding)
-   [字节模式编码](https://www.thonky.com/qr-code-tutorial/byte-mode-encoding)
-   [汉字模式编码](https://www.thonky.com/qr-code-tutorial/kanji-mode-encoding)

![[Pasted image 20220729111552.png]]

#### 分解为8位代码字并在必要时添加填充字节
在获得由模式指示符、字符计数指示符和本页步骤 1 到 3 中描述的数据位组成的位串后，可能需要添加 0 和填充字节，因为 QR 码规范要求位串必须完全填满二维码的总容量。以下部分解释了将 0 和填充字节添加到位串的过程










3. 纠错编码
	1. QR 码使用纠错。这意味着，在创建代表文本的数据位字符串之后，您必须使用这些位通过称为 Reed-Solomon 纠错的过程生成纠错码字。QR 扫描仪读取数据码字和纠错码字。通过比较两者，扫描仪可以确定它是否正确读取数据，如果它没有正确读取数据，它可以纠正错误。[纠错编码](https://www.thonky.com/qr-code-tutorial/error-correction-coding)部分详细解释了生成纠错码字的过程。
4. 构建最终消息
	1. 在前面的步骤中生成的数据和纠错码字现在必须以正确的顺序排列。对于大型二维码，数据和纠错码字是分块生成的，这些块必须按照二维码规范进行交织。此过程在[结构最终消息](https://www.thonky.com/qr-code-tutorial/structure-final-message)部分中进行了说明。
5. 矩阵中的模块放置
	1. 生成数据码字和纠错码字并按正确顺序排列后，必须将这些位放入二维码矩阵中。码字以特定方式排列在矩阵中。在此步骤中，您还将放置所有 QR 码共有的图案，例如三个角上的框。这个过程[在矩阵](https://www.thonky.com/qr-code-tutorial/module-placement-matrix) 部分的模块放置中有详细解释。
6. 数据屏蔽
	1. QR 码矩阵中的某些模式会使 QR 码扫描仪难以正确读取代码。为了解决这个问题，QR 码规范定义了八种掩码模式，每一种都根据特定模式更改 QR 码。您必须确定这些掩码模式中的哪一个会产生具有最少不良特征的 QR 码。这是通过基于四个惩罚规则评估每个掩码矩阵来完成的。您的最终二维码必须使用导致最低罚分的掩码图案。[数据屏蔽](https://www.thonky.com/qr-code-tutorial/data-masking)部分 解释了屏蔽过程。
7. 格式和版本信息
	1. 最后一步是在二维码中添加格式和（如有必要）版本信息，方法是在之前步骤中留空的特定区域添加像素。格式像素标识此 QR 码中使用的纠错级别和掩码图案。版本像素对 QR 矩阵的大小进行编码，仅用于较大的 QR 码。


























