#SQLServer/Internal

#### DBCC PAGE

默认情况下，SQL Server 将输出发送`DBCC PAGE`到跟踪日志，而不是作为查询结果。要从`DBCC PAGE`SSMS 执行命令并直接在查询结果窗口中查看结果，我们首先需要启用跟踪标志 3604

```SQL
--Enable
DBCC TRACEON(3604);  

--Disable
DBCC TRACEOFF(3604);
```
跟踪标志在连接级别激活，因此在一个连接中启用它不会影响到服务器的任何其他连接。同样，一旦连接关闭，跟踪标志将不再有效。

DBCC PAGE (<Database>, <FileID>, <PageID>, <Style>)

Database 是我们要检查其页面的数据库的名称。接下来，是`FileID`我们要检查的文件的；对于大多数数据库来说，这将是`1`，因为只有一个数据文件。

SELECT * FROM sys.database_files WHERE type = 0;

接下来，`PageID`我们要检查页面的 。这可以是`PageID`数据库中任何有效的页面。例如，特殊文件头页是第 0 页，第 9 页是同样特殊的启动页（它仅存储在主文件中，且页码为`file_id`1），或者文件中存在的任何其他数据页。通常，您不会看到第 17 页及之后的用户数据页。

最后，我们得到以下`Style`值：

- 0 – 仅输出已解析的标头值。也就是说，没有原始字节，只有标头内容。
- 1 – 输出已解析的标题以及页面上每个记录的原始字节。
- 2 – 输出已解析的标题以及页面的完整原始字节内容，包括标题和正文。
- 3 – 输出页面上每条记录解析后的标题和解析后的记录列值。每条记录的原始字节也会输出。这通常是最有用的样式，因为它允许访问标题，并且能够将原始记录字节与列数据关联起来。


如何检查数据库主数据文件中第 16 页的行`AdventureWorks2008R2`。
DBCC PAGE (AdventureWorks2008R2, 1, 16, 3);

![[Pasted image 20250604103249.png]]